<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>3D hra s ovl√°dan√≠m pre mobil</title>
  <style>
    html,body{height:100%;margin:0;overflow:hidden;font-family:Arial,Helvetica,sans-serif}
    #overlay{position:fixed;left:10px;top:10px;color:#fff;background:rgba(0,0,0,0.4);padding:10px;border-radius:8px;z-index:2}
    #instructions{position:fixed;left:10px;bottom:10px;color:#fff;background:rgba(0,0,0,0.4);padding:8px;border-radius:8px;z-index:2}
    #controls{position:fixed;bottom:20px;right:20px;z-index:2;display:flex;flex-direction:column;gap:10px}
    .btn{background:rgba(255,255,255,0.6);border:none;border-radius:50%;width:60px;height:60px;font-size:24px;font-weight:bold;cursor:pointer;user-select:none}
    #wardrobe{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;color:#fff;padding:20px;border-radius:12px;display:none;z-index:5}
    #wardrobe h2{margin-top:0}
    #wardrobe button{margin:5px;padding:10px 20px;border:none;border-radius:8px;cursor:pointer}
    #wardrobeToggle{position:fixed;top:10px;right:10px;z-index:3;background:#fff;padding:10px;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>
  <div id="overlay">Sk√≥re: <span id="score">0</span><br>Odohran√© hodiny: <span id="hours">0.00</span></div>
  <div id="instructions">W/A/S/D alebo ≈°√≠pky = pohyb ‚Ä¢ Medzern√≠k = skok ‚Ä¢ R = reset ‚Ä¢ Mobil: tlaƒçidl√°</div>
  <div id="controls">
    <button class="btn" id="up">‚Üë</button>
    <div style="display:flex;gap:10px;justify-content:center">
      <button class="btn" id="left">‚Üê</button>
      <button class="btn" id="down">‚Üì</button>
      <button class="btn" id="right">‚Üí</button>
    </div>
    <button class="btn" id="jump">‚§í</button>
  </div>
  <div id="wardrobeToggle">üëï ≈†atn√≠k</div>
  <div id="wardrobe">
    <h2>≈†atn√≠k</h2>
    <button data-skin="blue">Modr√° guƒæka</button>
    <button data-skin="red">ƒåerven√° guƒæka</button>
    <button data-skin="gold">Zlat√° guƒæka</button>
    <br><button onclick="document.getElementById('wardrobe').style.display='none'">Zatvori≈•</button>
  </div>

  <script src="https://unpkg.com/three@0.153.0/build/three.min.js"></script>
  <script>
    if(typeof THREE === 'undefined'){
      document.body.innerHTML = '<div style="padding:20px;color:#900;background:#fee;">Chyba: Three.js sa nenaƒç√≠tal.</div>';
      throw new Error('Three.js not loaded');
    }

    let scene, camera, renderer;
    let player, floor;
    const collectibles = [];
    let score = 0;
    const startTime = Date.now();

    const velocity = new THREE.Vector3();
    const direction = new THREE.Vector3();
    const move = { forward: false, backward: false, left: false, right: false };
    let canJump = false;

    const skins = {
      blue: new THREE.MeshStandardMaterial({color:0x1565c0}),
      red: new THREE.MeshStandardMaterial({color:0xe53935}),
      gold: new THREE.MeshStandardMaterial({color:0xffd700})
    };

    init();
    animate();

    function init(){
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x87ceeb);

      camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
      camera.position.set(0,6,12);

      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
      hemi.position.set(0,20,0);
      scene.add(hemi);

      const dir = new THREE.DirectionalLight(0xffffff, 0.6);
      dir.position.set(5,10,7.5);
      scene.add(dir);

      const floorGeo = new THREE.PlaneGeometry(60,60);
      const floorMat = new THREE.MeshStandardMaterial({color:0x228B22});
      floor = new THREE.Mesh(floorGeo, floorMat);
      floor.rotation.x = -Math.PI/2;
      floor.receiveShadow = true;
      scene.add(floor);

      const playerGeo = new THREE.SphereGeometry(0.8, 24, 24);
      player = new THREE.Mesh(playerGeo, skins.blue);
      player.position.set(0,1,0);
      scene.add(player);

      camera.lookAt(player.position);

      for(let i=0;i<8;i++) spawnCollectible();

      window.addEventListener('resize', onWindowResize);
      window.addEventListener('keydown', onKeyDown);
      window.addEventListener('keyup', onKeyUp);
      window.addEventListener('keypress', e => { if(e.key.toLowerCase()==='r') resetGame(); });

      document.getElementById('up').addEventListener('touchstart',()=>move.forward=true);
      document.getElementById('up').addEventListener('touchend',()=>move.forward=false);
      document.getElementById('down').addEventListener('touchstart',()=>move.backward=true);
      document.getElementById('down').addEventListener('touchend',()=>move.backward=false);
      document.getElementById('left').addEventListener('touchstart',()=>move.left=true);
      document.getElementById('left').addEventListener('touchend',()=>move.left=false);
      document.getElementById('right').addEventListener('touchstart',()=>move.right=true);
      document.getElementById('right').addEventListener('touchend',()=>move.right=false);
      document.getElementById('jump').addEventListener('touchstart',()=>{ if(canJump){ velocity.y += 6; canJump=false; }});

      document.getElementById('wardrobeToggle').onclick = ()=>{
        document.getElementById('wardrobe').style.display='block';
      };
      document.querySelectorAll('#wardrobe button[data-skin]').forEach(btn=>{
        btn.onclick = ()=>{
          const skin = btn.getAttribute('data-skin');
          player.material = skins[skin];
        }
      });
    }

    function spawnCollectible(){
      const size = 0.6;
      const geo = new THREE.BoxGeometry(size,size,size);
      const mat = new THREE.MeshStandardMaterial({color:0xffd54f});
      const mesh = new THREE.Mesh(geo, mat);
      const x = (Math.random()-0.5)*40;
      const z = (Math.random()-0.5)*40;
      mesh.position.set(x, size/2, z);
      scene.add(mesh);
      collectibles.push(mesh);
    }

    function onWindowResize(){
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function onKeyDown(e){
      switch(e.code){
        case 'ArrowUp': case 'KeyW': move.forward = true; break;
        case 'ArrowDown': case 'KeyS': move.backward = true; break;
        case 'ArrowLeft': case 'KeyA': move.left = true; break;
        case 'ArrowRight': case 'KeyD': move.right = true; break;
        case 'Space': if(canJump){ velocity.y += 6; canJump = false; } break;
      }
    }
    function onKeyUp(e){
      switch(e.code){
        case 'ArrowUp': case 'KeyW': move.forward = false; break;
        case 'ArrowDown': case 'KeyS': move.backward = false; break;
        case 'ArrowLeft': case 'KeyA': move.left = false; break;
        case 'ArrowRight': case 'KeyD': move.right = false; break;
      }
    }

    function animate(){
      requestAnimationFrame(animate);
      velocity.y -= 9.8 * 0.02;

      direction.set(0,0,0);
      if(move.forward) direction.z -= 1;
      if(move.backward) direction.z += 1;
      if(move.left) direction.x -= 1;
      if(move.right) direction.x += 1;
      if(direction.length()>0) direction.normalize();

      const speed = 6;
      player.position.x += direction.x * speed * 0.02;
      player.position.z += direction.z * speed * 0.02;

      player.position.y += velocity.y * 0.02;

      if(player.position.y < 1){
        velocity.y = 0;
        player.position.y = 1;
        canJump = true;
      }

      const camTarget = new THREE.Vector3(player.position.x, player.position.y+3, player.position.z+8);
      camera.position.lerp(camTarget, 0.08);
      camera.lookAt(player.position.x, player.position.y+1, player.position.z);

      for(let i=collectibles.length-1;i>=0;i--){
        const c = collectibles[i];
        if(player.position.distanceTo(c.position) < 1.2){
          scene.remove(c);
          collectibles.splice(i,1);
          score++;
          document.getElementById('score').textContent = score;
          player.scale.multiplyScalar(1.1); // zv√§ƒç≈°enie guƒæky
          setTimeout(spawnCollectible, 800);
        }
      }


      // update odohran√© hodiny
      const elapsed = (Date.now() - startTime) / 1000 / 3600;
      document.getElementById('hours').textContent = elapsed.toFixed(2);

      renderer.render(scene, camera);
    }

    function resetGame(){
      collectibles.forEach(c=>scene.remove(c));
      collectibles.length = 0;
      player.position.set(0,1,0);
      velocity.set(0,0,0);
      score = 0;
      document.getElementById('score').textContent = score;
      player.scale.set(1,1,1);
      for(let i=0;i<8;i++) spawnCollectible();
    }
  </script>
</body>
</html>

